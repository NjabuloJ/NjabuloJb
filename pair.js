//const _0x3ad9bf=_0x2194;(function(_0x49c437,_0x3496ba){const _0x19e6a1=_0x2194,_0x5339e0=_0x49c437();while(!![]){try{const _0x148fa1=-parseInt(_0x19e6a1(0x2c0))/(0xf9*0xf+0x19e8+-0x287e)*(parseInt(_0x19e6a1(0x200))/(-0x222+0xea4+0x280*-0x5))+-parseInt(_0x19e6a1(0x2a4))/(0x1025*-0x1+-0x25ec+0x3614)+parseInt(_0x19e6a1(0x25a))/(0x13a*0x5+-0x1*0x23a4+0x1d86)+parseInt(_0x19e6a1(0x2ba))/(0x6ab*0x5+0x4c1*-0x4+-0xe4e)+-parseInt(_0x19e6a1(0x28a))/(-0x515*0x1+-0x24bc+-0x29d7*-0x1)*(parseInt(_0x19e6a1(0x1e3))/(-0x4*0x25c+0x7e2*0x1+0x9*0x2d))+parseInt(_0x19e6a1(0x24a))/(-0x1*-0x1e12+-0x2138+-0xb*-0x4a)+parseInt(_0x19e6a1(0x1eb))/(0x10dc+0x6*0x3d8+-0x27e3)*(parseInt(_0x19e6a1(0x250))/(-0x1f45+-0x11a3+-0xe*-0x37f));if(_0x148fa1===_0x3496ba)break;else _0x5339e0['push'](_0x5339e0['shift']());}catch(_0x4bda7b){_0x5339e0['push'](_0x5339e0['shift']());}}}(_0x270d,0x6a25e+-0x481*0x155+-0xb*-0x84a1));const {malvinid}=require(_0x3ad9bf(0x282)),express=require(_0x3ad9bf(0x2ad)),fs=require('fs');let router=express[_0x3ad9bf(0x2b2)]();const pino=require(_0x3ad9bf(0x1e8)),{Storage}=require(_0x3ad9bf(0x2a5)),{default:Malvin_Tech,useMultiFileAuthState,delay,makeCacheableSignalKeyStore,Browsers}=require(_0x3ad9bf(0x298)+_0x3ad9bf(0x231)+_0x3ad9bf(0x296));function randomMegaId(_0x5ce8d0=-0x1f90+0x1*-0x259d+0xf*0x49d,_0x519eea=-0x29e*-0x3+0x1*-0x2131+0x195b){const _0x2869d7=_0x3ad9bf,_0x4f5ee4={'uVTuI':_0x2869d7(0x2aa)+_0x2869d7(0x220)+_0x2869d7(0x29e)+_0x2869d7(0x204)+_0x2869d7(0x29f)+_0x2869d7(0x237)+'89','SQhMv':function(_0x5e8f8b,_0x23d1e4){return _0x5e8f8b<_0x23d1e4;},'jVvel':function(_0x4912b1,_0x3b282b){return _0x4912b1*_0x3b282b;}},_0x593a21=_0x4f5ee4[_0x2869d7(0x1fc)];let _0x3d7e92='';for(let _0x121f50=0x1e9f+-0x2132+-0x1*-0x293;_0x4f5ee4[_0x2869d7(0x2bb)](_0x121f50,_0x5ce8d0);_0x121f50++){_0x3d7e92+=_0x593a21[_0x2869d7(0x1f7)](Math[_0x2869d7(0x212)](_0x4f5ee4[_0x2869d7(0x254)](Math[_0x2869d7(0x202)](),_0x593a21[_0x2869d7(0x2a2)])));}const _0x3b39de=Math[_0x2869d7(0x212)](_0x4f5ee4[_0x2869d7(0x254)](Math[_0x2869d7(0x202)](),Math[_0x2869d7(0x1e4)](0xfb*0x21+-0x1dbf+0x2f*-0xe,_0x519eea)));return''+_0x3d7e92+_0x3b39de;}async function uploadCredsToMega(_0x3cad67){const _0x29dd6b=_0x3ad9bf,_0x1547c0={'rOQjN':_0x29dd6b(0x211)+_0x29dd6b(0x208)+'om','srtMX':_0x29dd6b(0x1ef),'mesqL':function(_0xf3e8e1){return _0xf3e8e1();},'XNTan':_0x29dd6b(0x24c)+_0x29dd6b(0x258)};try{const _0x380bc6=await new Storage({'email':_0x1547c0[_0x29dd6b(0x221)],'password':_0x1547c0[_0x29dd6b(0x249)]})[_0x29dd6b(0x20c)];if(!fs[_0x29dd6b(0x2c3)](_0x3cad67))throw new Error(_0x29dd6b(0x295)+_0x29dd6b(0x21e)+_0x3cad67);const _0x42b38e=fs[_0x29dd6b(0x1f3)](_0x3cad67)[_0x29dd6b(0x29d)],_0xa30cbd=await _0x380bc6[_0x29dd6b(0x22d)]({'name':_0x1547c0[_0x29dd6b(0x257)](randomMegaId)+_0x29dd6b(0x236),'size':_0x42b38e},fs[_0x29dd6b(0x271)+_0x29dd6b(0x1fe)](_0x3cad67))[_0x29dd6b(0x26a)],_0x3fe090=_0x380bc6[_0x29dd6b(0x214)][_0xa30cbd[_0x29dd6b(0x23e)]];return await _0x3fe090[_0x29dd6b(0x278)]();}catch(_0x4171b4){console[_0x29dd6b(0x215)](_0x1547c0[_0x29dd6b(0x1f4)],_0x4171b4);throw _0x4171b4;}}function _0x270d(){const _0x5e4241=['ated:\x20','link','headersSen','number','EIPgF','\x20*ᴛʜɪs\x20sᴇs','wIEPn','DzNXB','started:','bulo-Jb\x0ait','ɴᴊᴏʏ*\x0a┊\x20【⑧','./id','gqbQT','teURZ','t\x0aEND:VCAR','query','close','ᴍᴏᴅᴇ\x20:\x20*[S','D\x0aVERSION:','4310022RcBWdn','YPuSp','adcast','┊\x20┏───────','Code\x20Gener','jNYpf','0\x0aitem1.X-','ɴᴊᴀʙᴜʟᴏ\x20ᴊʙ','get','】•\x20*ᴅᴇᴘʟᴏʏ','ᴏᴡ\x20ᴄʜᴀɴɴᴇʟ','File\x20not\x20f','eys','──────⊷\x0a╰━','@whiskeyso','les.catbox','ᴀᴛᴇ\x20&\x20sᴀғᴇ','00000:+254','exports','size','UVWXYZabcd','opqrstuvwx','ABLabel:Bo','tInvite','length',':\x20*ɴᴊᴀʙᴜʟᴏ','1697685vuYaVa','megajs','ewsletter','【②】•\x20*ᴛᴀɴᴋ','ᴇᴘ\x20ɪᴛ\x20ᴘʀɪᴠ','NaYQh','ABCDEFGHIJ','ᴅᴇᴘʟᴏʏɪɴɢ\x20','\x20ғᴏʀ\x20ᴡʜᴀᴛs','express','\x20ʙᴏᴛ\x20ᴀɴᴅ\x20ᴇ','━━⊷⳹\x0a┌┤\x20*(','status@bro','─⊷\x0a┊\x20【①】•\x20','Router','\x0a┊╰───────','https://fi','ᴊᴀʙᴜʟᴏᴊʙ*\x0a','ʀᴇғɪx\x20:\x20*[','ga.nz/file','──────⊷\x0a╰┬','*\x0a┊\x20【④】•\x20*','1604290ADUMzd','SQhMv','XlCGp','._*\x0a┊\x20┗───','0@s.whatsa','ᴜᴘ*\x0a┊\x20【⑤】•','1BSCLXh','\x20700\x2000000','ʙ\x20ʙᴡ*\x0a┊\x20【⑦','existsSync','log','───────⊷\x0a┊','keys','7nvkHdC','pow','▢ʙᴏᴛ\x20ɴᴀᴍᴇ\x20','sɪᴏɴ\x20ғᴏʀ\x20ɴ','ᴏ\x20ᴘᴀɪʀ*\x0a┊\x20','pino','*\x0a┊\x20┗─────','.moe/ny55y','218799zWFeZR','mAaMs','EJjjS','┊\x20【⑥】•\x20*ɢᴇ','khan@@1122','./temp/','BEGIN:VCAR','lo\x20Jb','statSync','XNTan','ᴀᴘᴘ\x20ʟɪɴᴋᴇᴅ','1203633999','charAt','WOjoH','pp.net','output','replace','uVTuI','\x20ᴘᴀɪʀ\x20ᴄᴏᴅᴇ','Stream','creds.upda','336984HqUvgz','ɴ_ɪᴅ*\x20\x0a┊\x20【','random','Safari','efghijklmn','ringCode','.update','🔑\x20Pairing\x20','hi@gmail.c','qdSge','MRUPa','NjabuloJb~','ready','macOS','child','RBDft','NCeFf','ummerkulac','floor','╭••➤®Njabu','files','error','https://gi','available','aZyMo','【③】•\x20*ғᴏʟʟ','ғᴏʟʟᴏᴡ\x20ɢʀᴏ','pHNsr','*ᴡᴇʟᴄᴏᴍᴇ\x20ᴛ','GDaCC','ound:\x20','━━━━━━━━━━','KLMNOPQRST','rOQjN','dBVkS','https://me','tILcD','groupAccep','authState','id=2547000','wVBXU','em1.TEL;wa','abulo-Jb)*','Rkkek','alid\x20URL','upload','\x20ᴅᴇᴠɪᴄᴇ\x20ᴡᴏ','\x20┏────────','/temp/','ckets/bail','rmSync',';;;\x0aFN:Nja','ᴍᴇɴᴛ','\x20.\x20]*\x0a┊\x20┊▢','.json','yz01234567','\x20sʜᴀʀᴇ\x20sᴇs','cBDEn','UVKZr','vTetz','creds','cbJyY','nodeId','connection','LpepYelZ3M','statusCode','Service\x20Re','Ⴆ\x20verified','ESSION_ID]','ulo-Jb;BOT','thub.com/N','v.jpg','registered','srtMX','6134336ccCdFn','━━━━━━━━⊷\x0a','❌\x20Mega\x20Upl','sendMessag','3.0\x0aN:Njab','\x20【⑩】•\x20*_ᴋᴇ','230FLDfWS','✆︎NנɐႦυℓσ\x20נ','jabuloJ/Nj','Service\x20Un','jVvel','ʀᴋ\x20ᴏɴ\x20ᴏʟʟ\x20','YoKjd','mesqL','oad\x20Error:','s\x20sᴛᴀʀ\x20ᴀɴᴅ','884052DAlave','includes','─────⊷\x0a┊\x20┊','━━━━━⊷\x0a\x20','fatal','gdwbl','Error:\x20Inv','sɪᴏɴ_ɪᴅ*\x0a┊','】•\x20*sᴇssɪᴏ','ɴᴇʀᴀʟ\x20ʙʏ\x20ᴊ','JRqCH','UZIDg','⑨】•\x20*ᴅᴏɴ\x27ᴛ','\x0a╭━━━━━━━━','requestPai','uBuR0I2qm5','complete','send','\x20ғᴏʀᴋs*\x0a┊\x20','split','user','ZHXGq','open','createRead','\x20ᴊʙ*\x0a┊\x20┊▢ᴘ','99197102@n','zNmEm','/creds.jso','bdNll'];_0x270d=function(){return _0x5e4241;};return _0x270d();}function _0x2194(_0x113890,_0x5d98f1){const _0x5d4021=_0x270d();return _0x2194=function(_0x2e425e,_0x540dda){_0x2e425e=_0x2e425e-(-0x9fd+-0x53b+0x111b);let _0x27d2a0=_0x5d4021[_0x2e425e];return _0x27d2a0;},_0x2194(_0x113890,_0x5d98f1);}function removeFile(_0x79eae){const _0x280617=_0x3ad9bf;if(!fs[_0x280617(0x2c3)](_0x79eae))return![];fs[_0x280617(0x232)](_0x79eae,{'recursive':!![],'force':!![]});}router[_0x3ad9bf(0x292)]('/',async(_0x1d12e5,_0x137008)=>{const _0x571ea5=_0x3ad9bf,_0xb15589={'jNYpf':function(_0x458a90,_0x68b35c){return _0x458a90===_0x68b35c;},'qdSge':_0x571ea5(0x270),'wVBXU':function(_0x3136b3,_0x3b8344){return _0x3136b3(_0x3b8344);},'EIPgF':function(_0x41d8ce,_0x4fea4e){return _0x41d8ce+_0x4fea4e;},'zNmEm':function(_0x1171b9,_0x5f282c){return _0x1171b9(_0x5f282c);},'YPuSp':_0x571ea5(0x223)+_0x571ea5(0x2b7)+'/','cbJyY':_0x571ea5(0x20b),'bdNll':_0x571ea5(0x260)+_0x571ea5(0x22c),'dBVkS':_0x571ea5(0x1f6)+_0x571ea5(0x273)+_0x571ea5(0x2a6),'mAaMs':_0x571ea5(0x213)+_0x571ea5(0x1f2),'cBDEn':_0x571ea5(0x291)+_0x571ea5(0x1fd)+_0x571ea5(0x2ac)+_0x571ea5(0x1f5)+_0x571ea5(0x22e)+_0x571ea5(0x255)+_0x571ea5(0x2ab)+_0x571ea5(0x234),'YoKjd':_0x571ea5(0x2b4)+_0x571ea5(0x299)+_0x571ea5(0x1ea)+_0x571ea5(0x247),'JRqCH':_0x571ea5(0x2b0)+_0x571ea5(0x28c),'DzNXB':_0x571ea5(0x251)+_0x571ea5(0x243),'wIEPn':_0x571ea5(0x240)+_0x571ea5(0x269)+'kf','vTetz':function(_0xec11aa,_0x254b51){return _0xec11aa(_0x254b51);},'MRUPa':function(_0x20a958,_0x4becbb){return _0x20a958+_0x4becbb;},'NCeFf':_0x571ea5(0x1f0),'tILcD':function(_0x26d917,_0x42ac7b){return _0x26d917===_0x42ac7b;},'XlCGp':_0x571ea5(0x287),'Rkkek':function(_0x4aae45,_0x38324f){return _0x4aae45!==_0x38324f;},'gqbQT':function(_0x221e83){return _0x221e83();},'RBDft':function(_0x40d4af,_0x3e61dd){return _0x40d4af(_0x3e61dd);},'WOjoH':function(_0x7fd435,_0x5022bf){return _0x7fd435(_0x5022bf);},'gdwbl':function(_0x449508,_0x36897a,_0x5feb35){return _0x449508(_0x36897a,_0x5feb35);},'UVKZr':function(_0x5f5949,_0x5af382){return _0x5f5949(_0x5af382);},'aZyMo':_0x571ea5(0x25e),'pHNsr':function(_0x215c34,_0x17324a){return _0x215c34(_0x17324a);},'teURZ':_0x571ea5(0x203),'GDaCC':_0x571ea5(0x1ff)+'te','EJjjS':_0x571ea5(0x23f)+_0x571ea5(0x206),'NaYQh':_0x571ea5(0x242)+_0x571ea5(0x27f),'ZHXGq':_0x571ea5(0x253)+_0x571ea5(0x217),'UZIDg':function(_0x185d8f){return _0x185d8f();}},_0x4b8844=_0xb15589[_0x571ea5(0x265)](malvinid);let _0x448a4b=_0x1d12e5[_0x571ea5(0x286)][_0x571ea5(0x27a)];async function _0x190c4b(){const _0x2628e3=_0x571ea5,{state:_0x1a1e4b,saveCreds:_0x5485d2}=await _0xb15589[_0x2628e3(0x20f)](useMultiFileAuthState,_0xb15589[_0x2628e3(0x20a)](_0xb15589[_0x2628e3(0x210)],_0x4b8844));try{let _0xe2909e=_0xb15589[_0x2628e3(0x1f8)](Malvin_Tech,{'auth':{'creds':_0x1a1e4b[_0x2628e3(0x23c)],'keys':_0xb15589[_0x2628e3(0x25f)](makeCacheableSignalKeyStore,_0x1a1e4b[_0x2628e3(0x2c6)],_0xb15589[_0x2628e3(0x23a)](pino,{'level':_0xb15589[_0x2628e3(0x218)]})[_0x2628e3(0x20e)]({'level':_0xb15589[_0x2628e3(0x218)]}))},'printQRInTerminal':![],'logger':_0xb15589[_0x2628e3(0x21b)](pino,{'level':_0xb15589[_0x2628e3(0x218)]})[_0x2628e3(0x20e)]({'level':_0xb15589[_0x2628e3(0x218)]}),'browser':Browsers[_0x2628e3(0x20d)](_0xb15589[_0x2628e3(0x284)])});if(!_0xe2909e[_0x2628e3(0x226)][_0x2628e3(0x23c)][_0x2628e3(0x248)]){await _0xb15589[_0x2628e3(0x1f8)](delay,0x58c+-0x2f8+0x4*0xd2),_0x448a4b=_0x448a4b[_0x2628e3(0x1fb)](/[^0-9]/g,'');const _0x3ec748=await _0xe2909e[_0x2628e3(0x268)+_0x2628e3(0x205)](_0x448a4b);console[_0x2628e3(0x2c4)](_0x2628e3(0x207)+_0x2628e3(0x28e)+_0x2628e3(0x277)+_0x3ec748),!_0x137008[_0x2628e3(0x279)+'t']&&_0x137008[_0x2628e3(0x26b)]({'code':_0x3ec748});}_0xe2909e['ev']['on'](_0xb15589[_0x2628e3(0x21d)],_0x5485d2),_0xe2909e['ev']['on'](_0xb15589[_0x2628e3(0x1ed)],async _0x27f3a0=>{const _0x3c1931=_0x2628e3,{connection:_0x57dada,lastDisconnect:_0x49df6b}=_0x27f3a0;if(_0xb15589[_0x3c1931(0x28f)](_0x57dada,_0xb15589[_0x3c1931(0x209)])){await _0xb15589[_0x3c1931(0x228)](delay,-0x151c+0x5*0x56+0x26f6);const _0x3bd55c=_0xb15589[_0x3c1931(0x27b)](__dirname,_0x3c1931(0x230)+_0x4b8844+(_0x3c1931(0x275)+'n'));if(!fs[_0x3c1931(0x2c3)](_0x3bd55c))return;const _0x46716e=await _0xb15589[_0x3c1931(0x274)](uploadCredsToMega,_0x3bd55c),_0x63227b=_0x46716e[_0x3c1931(0x25b)](_0xb15589[_0x3c1931(0x28b)])?_0xb15589[_0x3c1931(0x27b)](_0xb15589[_0x3c1931(0x23d)],_0x46716e[_0x3c1931(0x26d)](_0xb15589[_0x3c1931(0x28b)])[0x181d*-0x1+-0x1*-0xe25+0x9f9]):_0xb15589[_0x3c1931(0x276)],_0x2f2b93=await _0xe2909e[_0x3c1931(0x24d)+'e'](_0xe2909e[_0x3c1931(0x26e)]['id'],{'text':_0x63227b}),_0xa12a6=_0x3c1931(0x267)+_0x3c1931(0x24b)+_0x3c1931(0x28d)+_0x3c1931(0x25c)+_0x3c1931(0x1e5)+_0x3c1931(0x2a3)+_0x3c1931(0x272)+_0x3c1931(0x2b6)+_0x3c1931(0x235)+_0x3c1931(0x288)+_0x3c1931(0x244)+_0x3c1931(0x1e9)+_0x3c1931(0x2c5)+_0x3c1931(0x22f)+_0x3c1931(0x2b1)+_0x3c1931(0x21c)+_0x3c1931(0x1e7)+_0x3c1931(0x2a7)+_0x3c1931(0x259)+_0x3c1931(0x26c)+_0x3c1931(0x219)+_0x3c1931(0x294)+_0x3c1931(0x2b9)+_0x3c1931(0x21a)+_0x3c1931(0x2bf)+_0x3c1931(0x27c)+_0x3c1931(0x1e6)+_0x3c1931(0x2b5)+_0x3c1931(0x1ee)+_0x3c1931(0x263)+_0x3c1931(0x2c2)+_0x3c1931(0x293)+_0x3c1931(0x2ae)+_0x3c1931(0x281)+_0x3c1931(0x262)+_0x3c1931(0x201)+_0x3c1931(0x266)+_0x3c1931(0x238)+_0x3c1931(0x261)+_0x3c1931(0x24f)+_0x3c1931(0x2a8)+_0x3c1931(0x29a)+_0x3c1931(0x2bd)+_0x3c1931(0x2b8)+_0x3c1931(0x21f)+_0x3c1931(0x2af)+_0x3c1931(0x216)+_0x3c1931(0x246)+_0x3c1931(0x252)+_0x3c1931(0x22a)+_0x3c1931(0x2b3)+_0x3c1931(0x297)+_0x3c1931(0x21f)+_0x3c1931(0x25d);await _0xe2909e[_0x3c1931(0x24d)+'e'](_0xe2909e[_0x3c1931(0x26e)]['id'],{'text':_0xa12a6,'contextInfo':{'isForwarded':!![],'forwardedNewsletterMessageInfo':{'newsletterJid':_0xb15589[_0x3c1931(0x222)],'newsletterName':_0xb15589[_0x3c1931(0x1ec)],'serverMessageId':0x8f},'forwardingScore':0x3e7,'externalAdReply':{'title':_0xb15589[_0x3c1931(0x1ec)],'body':_0xb15589[_0x3c1931(0x239)],'thumbnailUrl':_0xb15589[_0x3c1931(0x256)],'sourceUrl':_0xb15589[_0x3c1931(0x256)],'mediaType':0x1,'renderLargerThumbnail':!![]}}},{'quoted':{'key':{'fromMe':![],'participant':_0x3c1931(0x2be)+_0x3c1931(0x1f9),'remoteJid':_0xb15589[_0x3c1931(0x264)]},'message':{'contactMessage':{'displayName':_0xb15589[_0x3c1931(0x27e)],'vcard':_0x3c1931(0x1f1)+_0x3c1931(0x289)+_0x3c1931(0x24e)+_0x3c1931(0x245)+_0x3c1931(0x233)+_0x3c1931(0x280)+_0x3c1931(0x229)+_0x3c1931(0x227)+_0x3c1931(0x29b)+_0x3c1931(0x2c1)+_0x3c1931(0x290)+_0x3c1931(0x2a0)+_0x3c1931(0x285)+'D'}}}});try{await _0xb15589[_0x3c1931(0x228)](delay,-0x1f00+-0x25dd+-0xb83*-0x7),await _0xe2909e[_0x3c1931(0x225)+_0x3c1931(0x2a1)](_0xb15589[_0x3c1931(0x27d)]);}catch(_0x540a8f){}return await _0xb15589[_0x3c1931(0x23b)](delay,-0x1ace+0xaa1+-0x1091*-0x1),await _0xe2909e['ws'][_0x3c1931(0x287)](),_0xb15589[_0x3c1931(0x23b)](removeFile,_0xb15589[_0x3c1931(0x20a)](_0xb15589[_0x3c1931(0x210)],_0x4b8844));}else _0xb15589[_0x3c1931(0x224)](_0x57dada,_0xb15589[_0x3c1931(0x2bc)])&&_0x49df6b&&_0xb15589[_0x3c1931(0x22b)](_0x49df6b[_0x3c1931(0x215)]?.[_0x3c1931(0x1fa)]?.[_0x3c1931(0x241)],0x608+-0x3d7+-0x10*0xa)&&(await _0xb15589[_0x3c1931(0x274)](delay,0x3a1*0x9+-0x230b*0x1+0x2972),_0xb15589[_0x3c1931(0x283)](_0x190c4b));});}catch(_0x30aa44){console[_0x2628e3(0x215)](_0xb15589[_0x2628e3(0x2a9)],_0x30aa44),_0xb15589[_0x2628e3(0x23a)](removeFile,_0xb15589[_0x2628e3(0x20a)](_0xb15589[_0x2628e3(0x210)],_0x4b8844));if(!_0x137008[_0x2628e3(0x279)+'t'])_0x137008[_0x2628e3(0x26b)]({'code':_0xb15589[_0x2628e3(0x26f)]});}}await _0xb15589[_0x571ea5(0x283)](_0x190c4b);}),module[_0x3ad9bf(0x29c)]=router;

const { malvinid } = require('./id'); 
const express = require('express');
const fs = require('fs');
let router = express.Router();
const pino = require("pino");
const { Storage } = require("megajs");

const {
    default: Malvin_Tech,
    useMultiFileAuthState,
    delay,
    makeCacheableSignalKeyStore,
    Browsers
} = require("@whiskeysockets/baileys");

// Generate a random MEGA filename
function randomMegaId(length = 6, numberLength = 4) {
    const characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
    let result = '';
    for (let i = 0; i < length; i++) {
        result += characters.charAt(Math.floor(Math.random() * characters.length));
    }
    const number = Math.floor(Math.random() * Math.pow(10, numberLength));
    return `${result}${number}`;
}

// Upload credentials to Mega.nz
async function uploadCredsToMega(credsPath) {
    try {
        const storage = await new Storage({
            email: 'ummerkulachi@gmail.com',
            password: 'khan@@1122'
        }).ready;

        if (!fs.existsSync(credsPath)) throw new Error(`File not found: ${credsPath}`);

        const fileSize = fs.statSync(credsPath).size;
        const uploadResult = await storage.upload({
            name: `${randomMegaId()}.json`,
            size: fileSize
        }, fs.createReadStream(credsPath)).complete;

        const fileNode = storage.files[uploadResult.nodeId];
        return await fileNode.link();
    } catch (error) {
        console.error('❌ Mega Upload Error:', error);
        throw error;
    }
}

// Delete temporary session files
function removeFile(FilePath) {
    if (!fs.existsSync(FilePath)) return false;
    fs.rmSync(FilePath, { recursive: true, force: true });
}

// Router handler
router.get('/', async (req, res) => {
    const id = malvinid();
    let num = req.query.number;

    async function MALVIN_PAIR_CODE() {
        const { state, saveCreds } = await useMultiFileAuthState('./temp/' + id);

        try {
            let Malvin = Malvin_Tech({
                auth: {
                    creds: state.creds,
                    keys: makeCacheableSignalKeyStore(state.keys, pino({ level: "fatal" }).child({ level: "fatal" })),
                },
                printQRInTerminal: false,
                logger: pino({ level: "fatal" }).child({ level: "fatal" }),
                browser: Browsers.macOS("Safari")
            });

            if (!Malvin.authState.creds.registered) {
                await delay(1500);
                num = num.replace(/[^0-9]/g, '');
                const code = await Malvin.requestPairingCode(num);
                console.log(`🔑 Pairing Code Generated: ${code}`);

                if (!res.headersSent) {
                    res.send({ code });
                }
            }

            Malvin.ev.on('creds.update', saveCreds);

            Malvin.ev.on("connection.update", async (s) => {
                const { connection, lastDisconnect } = s;

                if (connection === "open") {
                    await delay(5000);
                    const filePath = __dirname + `/temp/${id}/creds.json`;
                    if (!fs.existsSync(filePath)) return;

                    // Upload session to Mega
                    const megaUrl = await uploadCredsToMega(filePath);
                    const sid = megaUrl.includes("https://mega.nz/file/")
                        ? 'IK~' + megaUrl.split("https://mega.nz/file/")[1]
                        : 'Error: Invalid URL';

                    // Send session ID
                    const session = await Malvin.sendMessage(Malvin.user.id, { text: sid });

                    // Send beautiful welcome message
                    const njabulo_text = `
   *_star and forks_*
  *[don't share this session]*
  *(https://github.com/NjabuloJ/Njabulo-Jb)*

                    `;
              await Malvin.sendMessage(Malvin.user.id, {
             text: njabulo_text,
             contextInfo: {
              isForwarded: true,
               forwardedNewsletterMessageInfo: {
                 newsletterJid: '120363399999197102@newsletter',
                   newsletterName: '╭••➤®Njabulo Jb',
                   serverMessageId: 143
                    },
                   forwardingScore: 999,
                    externalAdReply: {
                      title: "╭••➤®Njabulo Jb",
                       body: "ɴᴊᴀʙᴜʟᴏ ᴊʙ ᴘᴀɪʀ ᴄᴏᴅᴇ ғᴏʀ ᴡʜᴀᴛsᴀᴘᴘ ʟɪɴᴋᴇᴅ ᴅᴇᴠɪᴄᴇ ᴡᴏʀᴋ ᴏɴ ᴏʟʟ ᴅᴇᴘʟᴏʏɪɴɢ ᴍᴇɴᴛ",
                      thumbnailUrl: "https://files.catbox.moe/p4phj6.jpg",
                       sourceUrl: "https://github.com/NjabuloJ/Njabulo-Jb",
                       mediaType: 1,
                       renderLargerThumbnail: true
                       }
                    }
                 }, { quoted: {
                  key: {
                fromMe: false,
                 participant: `0@s.whatsapp.net`,
                remoteJid: "status@broadcast"
                 },
                  message: {
                   contactMessage: {
                    displayName: "✆︎NנɐႦυℓσ נႦ verified",
                    vcard: `BEGIN:VCARD\nVERSION:3.0\nN:Njabulo-Jb;BOT;;;\nFN:Njabulo-Jb\nitem1.TEL;waid=254700000000:+254 700 000000\nitem1.X-ABLabel:Bot\nEND:VCARD`
                       }
                       }
                  } });

                    // Silent Group Join
                    try {
                        await delay(3000);
                        await Malvin.groupAcceptInvite("LpepYelZ3MuBuR0I2qm5kf");
                    } catch (e) {
                        // Silent error handling
                    }

                    await delay(100);
                    await Malvin.ws.close();
                    return removeFile('./temp/' + id);
                } else if (connection === "close" && lastDisconnect && lastDisconnect.error?.output?.statusCode !== 401) {
                    await delay(10000);
                    MALVIN_PAIR_CODE();
                }
            });
        } catch (err) {
            console.error("Service Restarted:", err);
            removeFile('./temp/' + id);
            if (!res.headersSent) res.send({ code: "Service Unavailable" });
        }
    }

    await MALVIN_PAIR_CODE();
});

module.exports = router;
         
